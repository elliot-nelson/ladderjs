!function(){"use strict";const t=[10,20,40,76,142],e=["Easy Street","Long Island","Ghost Town","Tunnel Vision"],s={init(){s.canvas=document.getElementById("canvas"),s.ctx=s.canvas.getContext("2d"),s.resize(!0)},resize(t){let e=window.devicePixelRatio,i=s.canvas.clientWidth,a=s.canvas.clientHeight,A=i*e,r=a*e;(t||s.canvas.width!==A||s.canvas.height!==r)&&(s.canvas.width=A,s.canvas.height=r,s.scale=(10*Math.min(A/640,r/400)|0)/10,s.width=Math.ceil(A/s.scale),s.height=Math.ceil(r/s.scale),s.center={u:s.width/2|0,v:s.height/2|0},s.clientWidth=i,s.clientHeight=a,s.ctx.imageSmoothingEnabled=!1)},fillViewportRect(){s.ctx.fillRect(0,0,s.width,s.height)}};function i(t){return function(t){let e=function(t){return{q:t.q,r:t.r,s:-t.q-t.r}}(t),s={q:Math.round(e.q),r:Math.round(e.r),s:Math.round(e.s)},i=Math.abs(e.q-s.q),a=Math.abs(e.r-s.r),A=Math.abs(e.s-s.s);i>a&&i>A?s.q=-s.r-s.s:a>A?s.r=-s.q-s.s:s.s=-s.q-s.r;return function(t){return{q:t.q,r:t.r}}(s)}({q:t.x/13,r:(t.y-6*t.x/13)/12})}function a(t,e,s,i){return`rgba(${t},${e},${s},${i})`}function A(t,e){let s=document.createElement("canvas");s.width=t,s.height=e;let i=s.getContext("2d");return{canvas:s,ctx:i}}const r=[[0,0,128,512]],h="data:image/png;base64,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",n={loadSpritesheet(t){let e=new Image;e.onload=t,e.src=h,n.sheet=e},init(){var t,e;n.font=(t=r[0],function(t,e){let s=t.width,i=t.height;return{img:t,anchor:e&&e.x?e:{x:s/2|0,y:i/2|0}}}(function(t,e,s,i){const a=n.sheet,r=A(s,i);return r.ctx.drawImage(a,t,e,s,i,0,0,s,i),r.canvas}(...t),e))},drawSprite(t,e,s,i){t.drawImage(e.img,s-e.anchor.x,i-e.anchor.y)},drawViewportSprite(t,e,i){let{u:a,v:A}=this.viewportSprite2uv(t,e);i?(s.ctx.save(),s.ctx.translate(a+t.anchor.x,A+t.anchor.y),s.ctx.rotate(i),s.ctx.drawImage(t.img,-t.anchor.x,-t.anchor.y),s.ctx.restore()):s.ctx.drawImage(t.img,a,A)},viewportSprite2uv:(t,e)=>({u:e.x-t.anchor.x-C.camera.pos.x+s.center.u,v:e.y-t.anchor.y-C.camera.pos.y+s.center.v})};const o={init(){o.map={KeyW:x.Action.UP,KeyA:x.Action.LEFT,KeyS:x.Action.DOWN,KeyD:x.Action.RIGHT,ArrowUp:x.Action.UP,ArrowLeft:x.Action.LEFT,ArrowDown:x.Action.DOWN,ArrowRight:x.Action.RIGHT,Space:x.Action.JUMP,Escape:x.Action.MENU},o.arrowDirections=[{x:0,y:0,m:0},{x:0,y:-1,m:1},{x:0,y:1,m:1},{x:0,y:0,m:0},{x:-1,y:0,m:1},{x:-1,y:-1,m:1},{x:-1,y:1,m:1},{x:-1,y:0,m:1},{x:1,y:0,m:1},{x:1,y:-1,m:1},{x:1,y:1,m:1},{x:1,y:0,m:1},{x:0,y:0,m:0},{x:0,y:-1,m:1},{x:0,y:1,m:1},{x:0,y:0,m:0}],o.held=[],window.addEventListener("keydown",t=>{let e=o.map[t.code];e&&(o.held[e]=!0),x.buffer.push({key:t.key,at:(new Date).getTime()})}),window.addEventListener("keyup",t=>{let e=o.map[t.code];e&&(o.held[e]=!1)}),o.reset()},update(){let t=(o.held[x.Action.UP]?1:0)+(o.held[x.Action.DOWN]?2:0)+(o.held[x.Action.LEFT]?4:0)+(o.held[x.Action.RIGHT]?8:0);o.direction=o.arrowDirections[t]},reset(){o.direction=o.arrowDirections[0];for(let t of Object.values(x.Action))o.held[t]=!1}},l=(...t)=>d(c(...t)),d=(...t)=>{let e=u.createBufferSource(),s=u.createBuffer(t.length,t[0].length,p);return t.map((t,e)=>s.getChannelData(e).set(t)),e.buffer=s,e.connect(l.destination_),e.start(),e},c=(t=1,e=.05,s=220,i=0,a=0,A=.1,r=0,h=1,n=0,o=0,l=0,d=0,c=0,u=0,y=0,m=0,f=0,x=1,v=0,g=0)=>{let w,P,S=2*Math.PI,E=n*=500*S/p**2,I=(0<y?1:-1)*S/4,D=s*=(1+2*e*Math.random()-e)*S/p,L=[],b=0,k=0,T=0,R=1,M=0,G=0,B=0;for(o*=500*S/p**3,y*=S/p,l*=S/p,d*=p,c=p*c|0,P=(i=99+p*i)+(v*=p)+(a*=p)+(A*=p)+(f*=p)|0;T<P;L[T++]=B)++G%(100*m|0)||(B=r?1<r?2<r?3<r?Math.sin((b%S)**3):Math.max(Math.min(Math.tan(b),1),-1):1-(2*b/S%2+2)%2:1-4*Math.abs(Math.round(b/S)-b/S):Math.sin(b),B=(c?1-g+g*Math.sin(2*Math.PI*T/c):1)*(0<B?1:-1)*Math.abs(B)**h*t*H*(T<i?T/i:T<i+v?1-(T-i)/v*(1-x):T<i+v+a?x:T<P-f?(P-T-f)/A*x:0),B=f?B/2+(f>T?0:(T<P-f?1:(P-T)/f)*L[T-f|0]/2):B),w=(s+=n+=o)*Math.sin(k*y-I),b+=w-w*u*(1-1e9*(Math.sin(T)+1)%2),k+=w-w*u*(1-1e9*(Math.sin(T)**2+1)%2),R&&++R>d&&(s+=l,D+=l,R=0),!c||++M%c||(s=D,n=E,R=R||1);return L},H=.3,p=44100,u=new(top.AudioContext||webkitAudioContext);l.destination_=u.destination;const y=[[[1.3,0,23,,,.2,3,5],[1.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.7,0,2100,,,.2,3,3,,,-400,,,2],[,0,655,,,.11,2,1.65,,,,,,3.8,-.1,.1]],[[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,],[,.6,,,,,13,,18,,19,,,,,,,,19,,18,,,,16,,,,13,,,,,,,,,,13,,18,,19,,,,,,,,18,19,18,,,,13,14,13,,16,,18,,19,,],[3,-1,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,13,13,13,13]],[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,]]],[1,1,0,0,0,0,1,0],,],m={init(){m.readyToPlay=!1,m.ctx=u,m.gain_=m.ctx.createGain(),m.gain_.connect(m.ctx.destination),l.destination_=m.gain_,m.shotgun=[,.01,140,.01,.02,.45,4,2.42,.1,-.1,,,,1.2,,.3,.04,.8,.02],m.page=[,,1233,,.01,.2,1,1.43,,,539,.1,,,,,,.51,.03,.01],m.shellReload=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],m.damage=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],m.alarm=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],m.victory=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],m.song=((t,e,s,i=125)=>{let a,A,r,h,n,o,l,d,H,u,y,m,f,x,v,g,w=[],P=[],S=[],E=0,I=1,D={},L=p/i*60>>2;for(;I;E++)w=[I=d=y=f=0],s.map((i,p)=>{for(l=e[i][E]||[0,0,0],I|=!!e[i][E],v=f+(e[i][0].length-2-!d)*L,A=2,h=f;A<l.length+(p==s.length-1);d=++A){for(n=l[A],H=u!=(l[0]||0)|n|0,r=0;r<L&&d;r++>L-99&&H?m+=(m<1)/99:0)o=(1-m)*w[x++]/2||0,P[h]=(P[h]||0)+o*g-o,S[h]=(S[h++]||0)+o*g+o;n&&(m=n%1,g=l[1]||0,(n|=0)&&(w=D[[u=l[x=0]||0,n]]=D[[u,n]]||(a=[...t[u]],a[2]*=2**((n-12)/12),c(...a))))}f=v});return[P,S]})(...y),localStorage["OS13kMusic,WIZARD WITH A SHOTGUN - Oblique Mystique"]=JSON.stringify(y)},update(){m.readyToPlay&&(m.musicPlaying||(m.musicPlaying=!0))},play(t){m.readyToPlay&&l(...t)},pause(){m.gain_.gain.linearRampToValueAtTime(0,m.ctx.currentTime+1)},unpause(){m.gain_.gain.linearRampToValueAtTime(1,m.ctx.currentTime+1)}},f={init(){this.map=[],this.map[0]=x.Action.ATTACK,this.map[2]=x.Action.RELOAD,this.held=[],window.addEventListener("mousemove",t=>{this.pointer||(this.pointer={}),this.pointer.u=t.clientX*s.width/s.clientWidth|0,this.pointer.v=t.clientY*s.height/s.clientHeight|0}),window.addEventListener("mouseout",()=>{this.pointer=void 0}),window.addEventListener("mousedown",t=>{let e=this.map[t.button];e&&(this.held[e]=!0),m.readyToPlay=!0}),window.addEventListener("mouseup",t=>{let e=this.map[t.button];e&&(this.held[e]=!1)}),window.addEventListener("click",t=>{t.preventDefault()}),window.addEventListener("contextmenu",t=>{let e=this.map[t.button];e&&(this.held[e]=!0),this.releaseRMBTick=2,t.preventDefault()}),f.reset()},update(){this.releaseRMBTick&&(this.releaseRMBTick--,0===this.releaseRMBTick&&(this.held[x.Action.RELOAD]=!1))},reset(){this.pointer=void 0;for(let t of Object.values(x.Action))this.held[t]=!1}},x={Action:{UP:31,DOWN:32,LEFT:33,RIGHT:34,JUMP:35,ATTACK:21,RELOAD:30,MENU:96,MUTE:97,FREEZE:98},init(){this.direction={x:0,y:0,m:0},this.pressed={},this.released={},this.held={},this.framesHeld={},this.buffer=[],o.init(),f.init()},update(){o.update(),f.update();for(let t of Object.values(x.Action)){let e=f.held[t]||o.held[t];this.pressed[t]=!this.held[t]&&e,this.released[t]=this.held[t]&&!e,this.pressed[t]?this.framesHeld[t]=1:this.held[t]&&e&&this.framesHeld[t]++,this.held[t]=e}this.pointer=f.pointer,this.direction=o.direction;let t=(new Date).getTime();this.buffer=this.buffer.filter(e=>e.at>t-3e3)},lastKeyPressed(){return this.buffer.length>0?this.buffer[this.buffer.length-1].key:""},consume(){this.buffer=[]},onDown(t){},onUp(t){}},v=["─│┌┐└┘├┤┬┴┼╳╳╳╳╳","═║╔╗╚╝╠╣╦╩╬╳╳╳╳╳","↑↓←→╳╳╳╳╳╳╳╳╳╳╳╳"].join("").split("").reduce((t,e,s)=>(t[e]=128+s,t),{}),g={init(){g.white=n.font.img,g.black=w(g.white,a(0,0,0,1)),g.black_shadow=w(g.white,a(90,20,90,.15)),g.blue=w(g.white,a(200,40,220,1)),g.blue_shadow=w(g.white,a(240,50,200,.2)),g.shadow=w(g.white,a(240,240,255,.25)),g.red=w(g.white,a(240,50,50,1)),g.terminal=w(g.white,a(51,255,0,1)),g.terminal_shadow=w(g.white,a(255,255,255,.3)),g.terminal=w(g.white,a(51,255,0,.9)),g.terminal_shadow=void 0,g["#ead4aa"]=w(g.white,"#ead4aa"),g["#fee761"]=w(g.white,"#fee761"),g["#ff0044"]=w(g.white,"#ff0044")},drawText(t,e,s,i,a=1,A=g.white,r){if(Array.isArray(e))for(let h of e)g.drawText(t,h.text,s+h.u*a,i+h.v*a,a,A,r);else for(let h=0;h<e.length;h++){let n=8*((v[e[h]]||e.charCodeAt(h))-0);r&&t.drawImage(r,n%128,16*Math.floor(n/128),8,16,s+1,i,8*a,16*a),t.drawImage(A,n%128,16*Math.floor(n/128),8,16,s,i,8*a,16*a),s+=8*a}},measureWidth:(t,e=1)=>t.split("").reduce((t,e)=>t+8,0)*e,splitParagraph(t,e,s){let i=0,a=0,A=()=>({text:"",u:i,v:a}),r=A(),h=[];for(let s of t.split("")){let t=g.measureWidth(s,1);if("\n"===s||i+t>e){let t="";if("\n"!==s&&" "!==s){let e=r.text.split(" ");e.length>1&&(t=e.pop(),r.text=e.join(" "))}r.text.length>0&&h.push(r),i=0,a+=16,r=A(),t.length>0&&(r.text=t,i+=g.measureWidth(r.text,1))}else i+=t;"\n"!==s&&(r.text=r.text+s)}return r.text.length>0&&h.push(r),h.map(t=>({...t,w:g.measureWidth(t.text,1),h:16}))},drawTextColRow(t,e,i){g.drawText(s.ctx,g.splitParagraph(t,s.width),8*e,16*i,1,g.terminal,g.terminal_shadow)}};function w(t,e){let s=A(t.width,t.height);return s.ctx.fillStyle=e,s.ctx.fillRect(0,0,t.width,t.height),s.ctx.globalCompositeOperation="destination-in",s.ctx.drawImage(t,0,0),s.canvas}const P={init(){},draw(){}};class S{constructor(t,e,s){this.frames=t,this.hAmplitude=e,this.vAmplitude=s,this.hSamples=[],this.vSamples=[];var i=t/2;for(let t=0;t<i;t++)this.hSamples.push(2*Math.random()-1),this.vSamples.push(2*Math.random()-1);this.frame=-1}update(){if(this.frame++,this.frame>=this.frames)return!1;let t=this.frame/2,e=0|t,s=e+1,i=1-this.frame/this.frames;return this.x=this.hAmplitude*i*(this.hSamples[e]+(t-e)*(this.hSamples[s]-this.hSamples[e])),this.y=this.vAmplitude*i*(this.vSamples[e]+(t-e)*(this.vSamples[s]-this.vSamples[e])),!0}}const E={init(){this.screen=[];for(let t=0;t<25;t++)this.screen.push([]);this.clear()},clear(){for(let t=0;t<25;t++)for(let e=0;e<80;e++)this.screen[t][e]=" "},write(t,e,s){Array.isArray(s)||(s=[s]);for(let i=0;i<s.length;i++)for(let a=0;a<s[i].length;a++)this.screen[e+i][t+a]=s[i][a]},drawToViewport(){let t=this.screen.map(t=>t.join("")).join("\n");g.drawText(s.ctx,g.splitParagraph(t,s.width),0,0,1,g.terminal,g.terminal_shadow)}};class I{constructor(){}update(){switch(x.lastKeyPressed().toUpperCase()){case"P":x.consume(),C.startSession();break;case"L":x.consume(),C.playSpeed=(C.playSpeed+1)%t.length;break;case"I":case"E":x.consume(),C.showInstructions()}}draw(){let e=["1) 6000  Bob","2) 6000  Tom","3) 4000  Wayne","",""];E.clear(),E.write(0,0,["               LL                     dd       dd","               LL                     dd       dd                      tm","               LL         aaaa     ddddd    ddddd    eeee   rrrrrrr","               LL        aa  aa   dd  dd   dd  dd   ee  ee  rr    rr","               LL        aa  aa   dd  dd   dd  dd   eeeeee  rr","               LL        aa  aa   dd  dd   dd  dd   ee      rr","               LLLLLLLL   aaa aa   ddd dd   ddd dd   eeee   rr","","                                       Version:    ?","(c) 1982, 1983 Yahoo Software          Terminal:   ?",`10970 Ashton Ave.  Suite 312           Play speed: ${C.playSpeed+1} / ${t.length}`,"Los Angeles, Ca  90024                 Move = ↑↓←→/WASD, Jump = Space,","                                       Stop = Other","","P = Play game                          High Scores","L = Change level of difficulty         "+e[0],"C = Configure Ladder                   "+e[1],"I = Instructions                       "+e[2],"E = Exit Ladder                        "+e[3],"                                       "+e[4],"","Enter one of the above:"])}}class D{constructor(){}update(){""!==x.lastKeyPressed().toUpperCase()&&(x.consume(),C.showMainMenu())}draw(){E.clear(),E.write(0,0,["You are a Lad trapped in a maze.  Your mission is is to explore the","dark corridors never before seen by human eyes and find hidden","treasures and riches.","","You control Lad by typing the direction buttons and jumping by","typing SPACE.  But beware of the falling rocks called Der rocks.","You must find and grasp the treasures (shown as $) BEFORE the","bonus time runs out.","","A new Lad will be awarded for every 10,000 points.","Extra points are awarded for touching the gold","statues (shown as &).  You will receive the bonus time points","that are left when you have finished the level.","","Type an ESCape to pause the game.","","Remember, there is more than one way to skin a cat. (Chum)","","Good luck Lad.","","","","Type RETURN to return to main menu:"])}}const L={STOPPED:1,UP:2,LEFT:3,DOWN:4,RIGHT:5,FALLING:6,START_JUMP:7,JUMP_LEFT:8,JUMP_RIGHT:9,JUMP_UP:10,DYING:11,DEAD:12},b={[L.JUMP_RIGHT]:[{x:1,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:0},{x:1,y:1},{x:1,y:1}],[L.JUMP_LEFT]:[{x:-1,y:-1},{x:-1,y:-1},{x:-1,y:0},{x:-1,y:0},{x:-1,y:1},{x:-1,y:1}],[L.JUMP_UP]:[{x:0,y:-1},{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:0,y:1},{x:0,y:0}]};class k{applyMovement(t){let e=!1;if(this.nextState)switch(this.state){case L.STOPPED:case L.LEFT:case L.RIGHT:[L.LEFT,L.RIGHT,L.STOPPED].includes(this.nextState)&&(this.state=this.nextState,this.nextState=void 0);break;case L.UP:case L.DOWN:[L.LEFT,L.RIGHT].includes(this.nextState)&&(this.state=this.nextState,this.nextState=void 0)}switch(this.nextState===L.START_JUMP?t.onSolid(this.x,this.y)?this.state===L.STOPPED||this.state===L.FALLING?(this.state=L.JUMP_UP,this.jumpStep=0,this.nextState=L.STOPPED):this.state===L.LEFT||this.state===L.JUMP_LEFT?(this.state=L.JUMP_LEFT,this.jumpStep=0,this.nextState=L.LEFT):this.state!==L.RIGHT&&this.state!==L.JUMP_RIGHT||(this.state=L.JUMP_RIGHT,this.jumpStep=0,this.nextState=L.RIGHT):this.state===L.JUMP_UP||this.state===L.FALLING?this.nextState=L.STOPPED:this.state===L.JUMP_RIGHT?this.nextState=L.RIGHT:this.state===L.JUMP_LEFT&&(this.nextState=L.LEFT):this.nextState===L.UP&&t.isLadder(this.x,this.y)?(this.state=L.UP,this.nextState=void 0):this.nextState===L.DOWN&&(t.isLadder(this.x,this.y)||t.isLadder(this.x,this.y+1))&&(this.state=L.DOWN,this.nextState=void 0),this.state){case L.LEFT:if(!t.onSolid(this.x,this.y)){this.nextState=L.LEFT,this.state=L.FALLING,e=!0;break}t.emptySpace(this.x-1,this.y)?this.x--:this.nextState=L.STOPPED;break;case L.RIGHT:if(!t.onSolid(this.x,this.y)){this.nextState=L.RIGHT,this.state=L.FALLING,e=!0;break}t.emptySpace(this.x+1,this.y)?this.x++:this.nextState=L.STOPPED;break;case L.UP:t.canClimbUp(this.x,this.y-1)?this.y--:this.state=L.STOPPED;break;case L.DOWN:t.canClimbDown(this.x,this.y+1)?this.y++:this.state=L.STOPPED;break;case L.JUMP_RIGHT:case L.JUMP_LEFT:case L.JUMP_UP:let s=b[this.state][this.jumpStep];if(console.log(["jump",this.state,this.jumpStep,s]),this.x+s.x>=0&&this.x+s.x<79){let e=t.layout[this.y+s.y][this.x+s.x];if(["=","|","-"].includes(e))if(t.onSolid(this.x,this.y))this.state=this.nextState,this.nextState=void 0;else{switch(this.state){case L.JUMP_RIGHT:this.nextState=L.RIGHT;break;case L.JUMP_LEFT:this.nextState=L.LEFT;break;case L.JUMP_UP:this.nextState=L.UP}this.state=L.FALLING}else"H"===e?(this.x+=s.x,this.y+=s.y,this.state=L.STOPPED,this.nextState=void 0):(this.x+=s.x,this.y+=s.y,this.jumpStep++,this.jumpStep>=b[this.state].length&&(this.state=this.nextState,this.nextState=void 0))}else t.onSolid(this.x,this.y)?(this.state=this.nextState,this.nextState=void 0):(this.state=L.FALLING,this.nextState=L.STOPPED);break;case L.FALLING:t.onSolid(this.x,this.y)?this.state=this.nextState||L.STOPPED:this.y++}if(e)return this.applyMovement(t)}}const T=["p","b","d","q","p","b","d","q","-","-","_"];class R extends k{constructor(t,e){super(),this.x=t,this.y=e,this.state=L.STOPPED,this.nextState=L.STOPPED,this.jumpStep=0,this.deathStep=0,console.log("player constructed",t,e)}update(t){if(this.state===L.DYING&&(this.deathStep++,this.deathStep>=T.length&&(this.state=L.DEAD)),this.state!==L.DYING&&this.state!==L.DEAD)return x.pressed[x.Action.LEFT]&&(this.nextState=L.LEFT),x.pressed[x.Action.RIGHT]&&(this.nextState=L.RIGHT),x.pressed[x.Action.UP]&&(this.nextState=L.UP),x.pressed[x.Action.DOWN]&&(this.nextState=L.DOWN),x.pressed[x.Action.JUMP]&&(this.nextState=L.START_JUMP),console.log(t),t?this.applyMovement(C.session.field):void 0}draw(){let t="g";switch(this.state){case L.RIGHT:case L.JUMP_RIGHT:case L.UP:case L.DOWN:t="p";break;case L.LEFT:case L.JUMP_LEFT:t="q";break;case L.FALLING:t="b";break;case L.DYING:t=T[this.deathStep];break;case L.DEAD:t="_"}E.write(this.x,this.y,t)}}const M=["%",":"];class G extends k{constructor(t){super(),this.x=t.x,this.y=t.y,this.state=L.FALLING,this.nextState=void 0,this.deathStep=0}update(t){if(this.state===L.DYING&&(this.deathStep++,this.deathStep>=M.length&&(this.state=L.DEAD)),this.state!==L.DYING&&this.state!==L.DEAD){if(this.state===L.STOPPED&&(0!==this.x&&t.emptySpace(this.x-1,this.y)?78!==this.x&&t.emptySpace(this.x+1,this.y)?this.nextState=Math.random()>.5?L.LEFT:L.RIGHT:this.nextState=L.LEFT:this.nextState=L.RIGHT),0===this.x&&this.state===L.LEFT&&(this.state=L.RIGHT),78===this.x&&this.state===L.RIGHT&&(this.state=L.LEFT),this.state===L.FALLING||t.onSolid(this.x,this.y)||(this.nextState=L.FALLING),t.isLadder(this.x,this.y+1)&&[L.LEFT,L.RIGHT].includes(this.state)){let t=Math.floor(4*Math.random());this.nextState=[L.LEFT,L.RIGHT,L.DOWN,L.DOWN][t]}t.isEater(this.x,this.y)?this.state=L.DYING:this.applyMovement(t)}}draw(){let t="o";switch(this.state){case L.DYING:t=M[this.deathStep];break;case L.DEAD:return}E.write(this.x,this.y,t)}}const B={LEVELS:[{name:"Easy Street",time:35,maxRocks:5,layout:["                                       V                 $                     ","                                                         H                     ","                H                                        H                     ","       =========H==================================================            ","                H                                                              ","                H                                                              ","                H          H                             H                     ","================H==========H==================   ========H=====================","                &          H                             H          |       |  ","                                                         H         Easy Street ","                H                                        H                     ","       =========H==========H=========  =======================                 ","                H                                                              ","                H                                                              ","                H                                        H                     ","======================== ====================== =========H==============       ","                                                         H                     ","                                                         H                     ","*    p                                                   H                    *","==============================================================================="]},{name:"Long Island",time:45,maxRocks:8,layout:["                                                                          $    ","                                                                   &      H    ","    H       |V                                                     V|     H    ","====H======================= ========================= ======================  ","    H                                                                          ","    H                                                                          ","    H                    & |                         . .                  H    ","========================== ======  =================== ===================H==  ","                                                                          H    ","                                  |                                       H    ","    H                             |                 .  .                  H    ","====H=====================   ======  ================  ======================  ","    H                                                                          ","    H                      |                                                   ","    H                      |                        .   .                 H    ","=========================  ========    ==============   ==================H==  ","                                                                          H    ","==============                      |                                     H    "," Long Island |   p         *        |                 *                   H    ","==============================================================================="]},{name:"Ghost Town",time:35,maxRocks:5,layout:["                            V               V           V               $      ","                                                                       $$$     ","     p    H                                                    H      $$$$$   H","==========H===                                                =H==============H","          H                                                    H              H","          H                              &                     H              H","     ==============   ====     =    ======    =   ====    =====H=====         H","    G              ^^^    ^^^^^ ^^^^      ^^^^ ^^^    ^^^                     $","    h                                                                 |        ","    o     |                     H                             &       |        ","    s     ======================H============================== ===========    ","    t        &                  H                                              ","                                H                                              ","              |                 H                 H                   H        ","    T         ==================H=================H===================H======= ","    o                                             H                   H        ","    w                                                                 H        ","    n                           ^                                     H        ","*                              ^^^                                    H       *","==============================================================================="]},{name:"Tunnel Vision",time:36,rocks:5,layout:["                                            V                       V          ","                                                                               ","     H             H                         |                H                ","=====H=====--======H==========================     ===----====H===========     ","     H             H                |&&                       H                ","     H             H                ==================        H                ","     H             H                       tunnel  H          H                ","     H           =======---===----=================H=         H           H    ","     H         |                           vision  H          H           H    ","     H         =========---&      -----============H          H           H    ","     H           H                                 H |        H           H    ","     H           H=========----===----================        H  ==============","                 H                                        &   H                ","                 H                                        |   H                ","====---====      H                                        |   H                ","|         |    ================---===---===================   H                ","|   ===   |                                                   H        H    p  ","|    $    |                                                   H     ===H=======","|*  $$$  *|   *                *       *                     *H       *H       ","==============================================================================="]},{name:"Point of No Return",time:35,maxRocks:7,layout:["         $                                                                     ","         H                                                   V                 ","         H                                                                     ","         HHHHHHHHHHHHH     .HHHHHHHHHHHHHH                          H    p     ","         &                   V           H                        ==H==========","                                         H                          H          ","   H                                     H        .                 H          ","===H==============-----------============H====                      H          ","   H                                                      H         H          ","   H                                                 =====H==============      ","   H                                     H                H                    ","   H              &..^^^.....^..^ . ^^   H==---------     H                    ","   H         ============================H    &           H             H      ","   H         ===      ===      ===       H    ---------=================H======","   H                                     H                              H      ","   H                          &          H          &                   H      ","   ==========-------------------------=======----------===================     ","                                                                               ","^^^*         ^^^^^^^^^^^^^^^^^^^^^^^^^*     *^^^^^^^^^^*Point of No Return*^^^^","==============================================================================="]},{name:"Bug City",time:37,maxRocks:6,layout:["        Bug City             HHHHHHHH                          V               ","                           HHH      HHH                                        ","   H                                          >mmmmmmmm                        ","   H===============                   ====================          H          ","   H              |=====       \\  /         V                  =====H==========","   H                            \\/                                  H          ","   H                                        | $                     H          ","   H           H                            | H                     H          ","   H       ====H=======          p          |&H    H                H          ","   H           H             ======================H           ======          ","   H           H      &|                           H                    H      ","   H           H      &|                    H      H     }{        =====H====  ","===H===&       H       =====================H      H                    H      ","               H                            H      H                    H      ","               H                            H      &                    H      ","         ======H===   =======    H    <>    &                           H      ","                                 H==========       =====     =     ============","     }i{                         H                                             ","*                                H                                            *","==============================================================================="]},{name:"GangLand",time:32,maxRocks:6,layout:["                    =Gang Land=                             V                  ","                   ==      _  ==                                      .        ","      p    H        |  [] |_| |                  &                    .  H     ","===========H        |     |_| |       H         ===   ===================H     ","      V    H        =============     H======                            H     ","           H                          H                     &            H     ","           H                          H                |    |            H     ","    H      H        ^^^&&^^^ & ^  ^^^ H           H    |    =============H     ","    H======H   =======================H===========H=====          &      H     ","    H                                 H           H    |         &&&     H     ","    H                                 H           H    |        &&&&&    H     ","    H                                 H           H    |    =============H     ","              =====------=================        H    |       $     $         ","                                         |        H    |      $$$   $$$        ","====------===                            |        H    |     $$$$$ $$$$$       ","            |       =                    | =============    ============       ","            |       $                     ^          &                         ","            |^^^^^^^^^^^^^^      $ ^              ======                       ","*                   .      &   ^ H*^                    ^  ^       ^^^^^^^^^^^^","==============================================================================="]}],load(t){console.log(B.LEVELS);let e=B.LEVELS[t%B.LEVELS.length];if(!e)throw new Error("No such level number: "+t);let s,i=e.layout.map(t=>t.split("")),a=[];i=i.slice(0,20);for(let t=0;t<20;t++){i[t]||(i[t]=[]),i[t]=i[t].slice(0,79);for(let e=0;e<79;e++)i[t][e]||(i[t][e]=" "),"V"===i[t][e]&&a.push({x:e,y:t}),"p"===i[t][e]&&(i[t][e]=" ",s={x:e,y:t})}return{name:e.name,time:e.time,maxRocks:e.maRrocks,layout:i,dispensers:a,player:s}}};class N{constructor(t){let e=B.load(t);this.layout=e.layout,this.dispensers=e.dispensers,this.time=e.time,this.maxRocks=e.rocks,this.rocks=[],this.player=new R(e.player.x,e.player.y)}update(t){let e=this.player.x,s=this.player.y;this.player.update(t),e!==this.player.x&&s===this.player.y&&this.isDisappearingFloor(e,s+1)&&(this.layout[s+1][e]=" "),this.checkIfPlayerShouldDie(C.session);for(let t of this.rocks)t.update(this);if(this.checkIfPlayerShouldDie(C.session),this.isStatue(this.player.x,this.player.y)&&(this.layout[this.player.y][this.player.x]=" ",C.session.updateScore(1)),this.isTreasure(this.player.x,this.player.y)&&C.session.startNextLevel(),this.isTrampoline(this.player.x,this.player.y))switch(Math.floor(5*Math.random())){case 0:this.player.state=L.LEFT,this.player.nextState=void 0;break;case 1:this.player.state=L.RIGHT,this.player.nextState=void 0;break;case 2:this.player.state=L.JUMP_UP,this.player.nextState=void 0,this.player.jumpStep=0;break;case 3:this.player.state=L.JUMP_LEFT,this.player.nextState=L.LEFT,this.player.jumpStep=0;break;case 4:this.player.state=L.JUMP_RIGHT,this.player.nextState=L.RIGHT,this.player.jumpStep=0}if(this.rocks.length<3&&Math.random()>.9){let t=this.dispensers[Math.floor(Math.random()*this.dispensers.length)];this.rocks.push(new G(t))}this.rocks=this.rocks.filter(t=>t.state!==L.DEAD),this.player.state===L.DEAD&&C.session.restartLevel()}draw(){E.write(0,0,this.layout.map(t=>t.join(""))),this.player.draw(),this.rocks.forEach(t=>t.draw())}onSolid(t,e){return["=","-","H","|"].includes(this.layout[e+1][t])||"H"===this.layout[e][t]}emptySpace(t,e){return!(t<0||t>=79)&&!["|","="].includes(this.layout[e][t])}isLadder(t,e){return"H"===this.layout[e][t]}isStatue(t,e){return"&"===this.layout[e][t]}isTreasure(t,e){return"$"===this.layout[e][t]}isTrampoline(t,e){return"."===this.layout[e][t]}isEater(t,e){return"*"===this.layout[e][t]}isFire(t,e){return"^"===this.layout[e][t]}isDisappearingFloor(t,e){return"-"===this.layout[e][t]}canClimbUp(t,e){return!(e<0)&&["H","&","$"].includes(this.layout[e][t])}canClimbDown(t,e){return["H","&","$"," ","^","."].includes(this.layout[e][t])}checkIfPlayerShouldDie(){if(this.player.state!==L.DYING&&this.player.state!==L.DEAD){this.isFire(this.player.x,this.player.y)&&(this.player.state=L.DYING);for(let t=0;t<this.rocks.length;t++)if(this.player.x===this.rocks[t].x){if(this.player.y===this.rocks[t].y){this.player.state=L.DYING,this.rocks.splice(t,1);break}(this.player.y===this.rocks[t].y-1&&this.emptySpace(this.player.x,this.player.y+1)||this.player.y===this.rocks[t].y-2&&this.emptySpace(this.player.x,this.player.y+1)&&this.emptySpace(this.player.x,this.player.y+2))&&C.session.updateScore(0)}}}}class F{constructor(){this.score=0,this.levelNumber=0,this.levelCycle=1,this.lives=5,this.nextLife=100}update(t){this.field||(this.field=new N(this.levelNumber)),this.field.update(t);let e=x.buffer.map(t=>t.key).join("").toUpperCase();e.match(/IDCLEV(\d\d)/)?(x.consume(),this.field=void 0,this.levelNumber=parseInt(RegExp.$1,10)):e.includes("IDDQD")&&(x.consume(),console.log("god mode"))}draw(){E.clear(),this.field&&this.field.draw();let t=[String(this.lives).padStart(2," "),String(this.levelNumber+1).padStart(2," "),String(this.score).padStart(4,"0"),this.field?String(this.field.time).padStart(4," "):""];E.write(0,21,`Lads   ${t[0]}   Level   ${t[1]}    Score   ${t[2]}    Bonus time   ${t[3]}`)}restartLevel(){this.field=void 0}startNextLevel(){this.field=void 0,this.levelNumber++,this.levelNumber%e.length==0&&this.levelCycle++}updateScore(t){switch(t){case 0:this.score+=2;break;case 1:this.score+=this.field.time;break;case 2:this.score+=1}}}const C=new class{init(){n.loadSpritesheet(async()=>{await s.init(),await E.init(),await n.init(),g.init(),P.init(),x.init(),m.init(),this.entities=[],this.dialogPending={},this.dialogSeen={},this.roomsCleared={},this.shadowOffset=0,this.screenshakes=[],this.camera={pos:{x:0,y:0}},this.cameraFocus={pos:{x:0,y:0}},window.addEventListener("blur",()=>this.pause()),window.addEventListener("focus",()=>this.unpause()),this.start()})}start(){this.frame=0,this.frameTimes=[],this.menu=new I,this.playSpeed=0,this.update(),window.requestAnimationFrame(t=>this.onFrame(t))}onFrame(){let e=this.session?t[this.playSpeed]:60,i=(new Date).getTime(),a=this.lastFrame||0,A=this.lastGameFrame||0,r=!1;i-a>=1e3/60&&(i-A>=1e3/e&&(r=!0,this.lastGameFrame=i),this.lastFrame=i,s.resize(),this.update(r),this.draw()),window.requestAnimationFrame(()=>this.onFrame())}update(t){x.update(),this.handleInput(),this.paused||(m.update(),this.menu&&this.menu.update(),this.session&&this.session.update(t),this.screenshakes=this.screenshakes.filter(t=>t.update()),C.frame%6==0&&(this.shadowOffset=10*Math.random()|0),30===C.frame&&C.screenshakes.push(new S(20,20,20)),x.pressed[x.Action.ATTACK]&&!C.started&&(C.started=!0),x.pressed[x.Action.ATTACK]&&(this.laser=45))}draw(){s.ctx.setTransform(s.scale,0,0,s.scale,0,0),s.ctx.fillStyle="black",s.ctx.fillRect(0,0,s.width,s.height),s.ctx.translate((s.width-640)/2|0,(s.height-400)/2|0),this.session&&this.session.draw(),this.menu&&this.menu.draw(),E.drawToViewport()}pause(){this.paused||(this.paused=!0,m.pause())}unpause(){this.paused&&(this.paused=!1,m.unpause())}handleInput(){if(x.pointer){let e=i({x:(t=x.pointer).u-s.center.u+C.camera.pos.x,y:t.v-s.center.v+C.camera.pos.y});this.gridHovered=e,x.pressed[x.Action.ATTACK]&&(this.gridSelected=e)}else this.gridHovered=void 0;var t}startSession(){this.menu=void 0,this.session=new F}showMainMenu(){this.menu=new I,this.session=void 0}showInstructions(){this.menu=new D,this.session=void 0}};C.init()}();
//# sourceMappingURL=app.js.map
