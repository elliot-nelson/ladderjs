!function(){"use strict";const PLAY_SPEEDS=[10,20,40,76,142],LEVEL_ORDER=["Easy Street","Long Island","Ghost Town","Tunnel Vision"],Viewport={init(){Viewport.canvas=document.getElementById("canvas"),Viewport.ctx=Viewport.canvas.getContext("2d"),Viewport.resize(!0)},resize(force){let dpi=window.devicePixelRatio,width=Viewport.canvas.clientWidth,height=Viewport.canvas.clientHeight,dpiWidth=width*dpi,dpiHeight=height*dpi;(force||Viewport.canvas.width!==dpiWidth||Viewport.canvas.height!==dpiHeight)&&(Viewport.canvas.width=dpiWidth,Viewport.canvas.height=dpiHeight,Viewport.scale=(10*Math.min(dpiWidth/640,dpiHeight/400)|0)/10,Viewport.width=Math.ceil(dpiWidth/Viewport.scale),Viewport.height=Math.ceil(dpiHeight/Viewport.scale),Viewport.center={u:Viewport.width/2|0,v:Viewport.height/2|0},Viewport.clientWidth=width,Viewport.clientHeight=height,Viewport.ctx.imageSmoothingEnabled=!1)},fillViewportRect(){Viewport.ctx.fillRect(0,0,Viewport.width,Viewport.height)}};function rgba(r,g,b,a){return`rgba(${r},${g},${b},${a})`}function createCanvas(width,height){let canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;let ctx=canvas.getContext("2d");return{canvas:canvas,ctx:ctx}}const SpriteSheet_font2=[[0,0,128,512]],SpriteSheet_base64="data:image/png;base64,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",Sprite={loadSpritesheet(cb){let image=new Image;image.onload=cb,image.src=SpriteSheet_base64,Sprite.sheet=image},init(){var data,anchor;Sprite.font=(data=SpriteSheet_font2[0],function(source,anchor){let w=source.width,h=source.height;return{img:source,anchor:anchor&&anchor.x?anchor:{x:w/2|0,y:h/2|0}}}(function(x,y,w,h){const source=Sprite.sheet,sliceCanvas=createCanvas(w,h);return sliceCanvas.ctx.drawImage(source,x,y,w,h,0,0,w,h),sliceCanvas.canvas}(...data),anchor))},drawSprite(ctx,sprite,u,v){ctx.drawImage(sprite.img,u-sprite.anchor.x,v-sprite.anchor.y)},drawViewportSprite(sprite,pos,rotation){let{u:u,v:v}=this.viewportSprite2uv(sprite,pos);rotation?(Viewport.ctx.save(),Viewport.ctx.translate(u+sprite.anchor.x,v+sprite.anchor.y),Viewport.ctx.rotate(rotation),Viewport.ctx.drawImage(sprite.img,-sprite.anchor.x,-sprite.anchor.y),Viewport.ctx.restore()):Viewport.ctx.drawImage(sprite.img,u,v)},viewportSprite2uv:(sprite,pos)=>({u:pos.x-sprite.anchor.x-game.camera.pos.x+Viewport.center.u,v:pos.y-sprite.anchor.y-game.camera.pos.y+Viewport.center.v})};const Action={UP:11,DOWN:12,LEFT:13,RIGHT:14,JUMP:15,STOP:16,PAUSE:17},Input={Action:Action,KeyMapping:{KeyW:Action.UP,KeyS:Action.DOWN,KeyA:Action.LEFT,KeyD:Action.RIGHT,ArrowUp:Action.UP,ArrowDown:Action.DOWN,ArrowLeft:Action.LEFT,ArrowRight:Action.RIGHT,Space:Action.JUMP},init(){this.buffer=[],this.history=[],window.addEventListener("keydown",event=>{let entry={at:(new Date).getTime(),key:event.key,code:event.code,action:Input.KeyMapping[event.code]||Input.Action.STOP};Input.buffer.push(entry),Input.history.push(entry),console.log(entry)})},update(){let now=(new Date).getTime();this.history=this.history.filter(entry=>entry.at>now-3e3)},lastKeyPressed(){return this.buffer.length>0?this.buffer[this.buffer.length-1].key:""},lastCodePressed(){return this.buffer.length>0?this.buffer[this.buffer.length-1].code:""},lastActionPressed(){return this.buffer.length>0?this.buffer[this.buffer.length-1].action:void 0},consume(){this.buffer=[]}},UNICODE_CHAR_MAP=["─│┌┐└┘├┤┬┴┼╳╳╳╳╳","═║╔╗╚╝╠╣╦╩╬╳╳╳╳╳","↑↓←→╳╳╳╳╳╳╳╳╳╳╳╳"].join("").split("").reduce((map,char,idx)=>(map[char]=128+idx,map),{}),Text={init(){Text.white=Sprite.font.img,Text.black=recolor(Text.white,rgba(0,0,0,1)),Text.black_shadow=recolor(Text.white,rgba(90,20,90,.15)),Text.blue=recolor(Text.white,rgba(200,40,220,1)),Text.blue_shadow=recolor(Text.white,rgba(240,50,200,.2)),Text.shadow=recolor(Text.white,rgba(240,240,255,.25)),Text.red=recolor(Text.white,rgba(240,50,50,1)),Text.terminal=recolor(Text.white,rgba(51,255,0,1)),Text.terminal_shadow=recolor(Text.white,rgba(255,255,255,.3)),Text.terminal=recolor(Text.white,rgba(51,255,0,.9)),Text.terminal_shadow=void 0,Text["#ead4aa"]=recolor(Text.white,"#ead4aa"),Text["#fee761"]=recolor(Text.white,"#fee761"),Text["#ff0044"]=recolor(Text.white,"#ff0044")},drawText(ctx,text,u,v,scale=1,font=Text.white,shadow){if(Array.isArray(text))for(let block of text)Text.drawText(ctx,block.text,u+block.u*scale,v+block.v*scale,scale,font,shadow);else for(let idx=0;idx<text.length;idx++){let k=8*((UNICODE_CHAR_MAP[text[idx]]||text.charCodeAt(idx))-0);shadow&&ctx.drawImage(shadow,k%128,16*Math.floor(k/128),8,16,u+1,v,8*scale,16*scale),ctx.drawImage(font,k%128,16*Math.floor(k/128),8,16,u,v,8*scale,16*scale),u+=8*scale}},measureWidth:(text,scale=1)=>text.split("").reduce((sum,c)=>sum+8,0)*scale,splitParagraph(text,w,h){let cu=0,cv=0,next=()=>({text:"",u:cu,v:cv}),wip=next(),list=[];for(let c of text.split("")){let cWidth=Text.measureWidth(c,1);if("\n"===c||cu+cWidth>w){let saved="";if("\n"!==c&&" "!==c){let space=wip.text.split(" ");space.length>1&&(saved=space.pop(),wip.text=space.join(" "))}wip.text.length>0&&list.push(wip),cu=0,cv+=16,wip=next(),saved.length>0&&(wip.text=saved,cu+=Text.measureWidth(wip.text,1))}else cu+=cWidth;"\n"!==c&&(wip.text=wip.text+c)}return wip.text.length>0&&list.push(wip),list.map(line=>({...line,w:Text.measureWidth(line.text,1),h:16}))},drawTextColRow(text,col,row){Text.drawText(Viewport.ctx,Text.splitParagraph(text,Viewport.width),8*col,16*row,1,Text.terminal,Text.terminal_shadow)}};function recolor(font,color){let canvas=createCanvas(font.width,font.height);return canvas.ctx.fillStyle=color,canvas.ctx.fillRect(0,0,font.width,font.height),canvas.ctx.globalCompositeOperation="destination-in",canvas.ctx.drawImage(font,0,0),canvas.canvas}const zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),f=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map((d,i)=>f.getChannelData(i).set(d)),e.buffer=f,e.connect(zzfx.destination_),e.start(),e},zzfxG=(q=1,k=.05,c=220,e=0,t=0,u=.1,r=0,F=1,v=0,z=0,w=0,A=0,l=0,B=0,x=0,G=0,d=0,y=1,m=0,C=0)=>{let p,h,b=2*Math.PI,H=v*=500*b/zzfxR**2,I=(0<x?1:-1)*b/4,D=c*=(1+2*k*Math.random()-k)*b/zzfxR,Z=[],g=0,E=0,a=0,n=1,J=0,K=0,f=0;for(z*=500*b/zzfxR**3,x*=b/zzfxR,w*=b/zzfxR,A*=zzfxR,l=zzfxR*l|0,h=(e=99+zzfxR*e)+(m*=zzfxR)+(t*=zzfxR)+(u*=zzfxR)+(d*=zzfxR)|0;a<h;Z[a++]=f)++K%(100*G|0)||(f=r?1<r?2<r?3<r?Math.sin((g%b)**3):Math.max(Math.min(Math.tan(g),1),-1):1-(2*g/b%2+2)%2:1-4*Math.abs(Math.round(g/b)-g/b):Math.sin(g),f=(l?1-C+C*Math.sin(2*Math.PI*a/l):1)*(0<f?1:-1)*Math.abs(f)**F*q*zzfxV*(a<e?a/e:a<e+m?1-(a-e)/m*(1-y):a<e+m+t?y:a<h-d?(h-a-d)/u*y:0),f=d?f/2+(d>a?0:(a<h-d?1:(h-a)/d)*Z[a-d|0]/2):f),p=(c+=v+=z)*Math.sin(E*x-I),g+=p-p*B*(1-1e9*(Math.sin(a)+1)%2),E+=p-p*B*(1-1e9*(Math.sin(a)**2+1)%2),n&&++n>A&&(c+=w,D+=w,n=0),!l||++J%l||(c=D,v=H,n=n||1);return Z},zzfxV=.3,zzfxR=44100,zzfxX=new(top.AudioContext||webkitAudioContext);zzfx.destination_=zzfxX.destination;const ObliqueMystique=[[[1.3,0,23,,,.2,3,5],[1.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.7,0,2100,,,.2,3,3,,,-400,,,2],[,0,655,,,.11,2,1.65,,,,,,3.8,-.1,.1]],[[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,],[,.6,,,,,13,,18,,19,,,,,,,,19,,18,,,,16,,,,13,,,,,,,,,,13,,18,,19,,,,,,,,18,19,18,,,,13,14,13,,16,,18,,19,,],[3,-1,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,13,13,13,13]],[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,]]],[1,1,0,0,0,0,1,0],,],Audio={init(){Audio.readyToPlay=!1,Audio.ctx=zzfxX,Audio.gain_=Audio.ctx.createGain(),Audio.gain_.connect(Audio.ctx.destination),zzfx.destination_=Audio.gain_,Audio.shotgun=[,.01,140,.01,.02,.45,4,2.42,.1,-.1,,,,1.2,,.3,.04,.8,.02],Audio.page=[,,1233,,.01,.2,1,1.43,,,539,.1,,,,,,.51,.03,.01],Audio.shellReload=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],Audio.damage=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],Audio.alarm=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],Audio.victory=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],Audio.song=((instruments,patterns,sequence,BPM=125)=>{let instrumentParameters,i,j,k,note,sample,patternChannel,notFirstBeat,stop,instrument,pitch,attenuation,outSampleOffset,sampleOffset,nextSampleOffset,panning,sampleBuffer=[],leftChannelBuffer=[],rightChannelBuffer=[],channelIndex=0,hasMore=1,sampleCache={},beatLength=zzfxR/BPM*60>>2;for(;hasMore;channelIndex++)sampleBuffer=[hasMore=notFirstBeat=pitch=outSampleOffset=0],sequence.map((patternIndex,sequenceIndex)=>{for(patternChannel=patterns[patternIndex][channelIndex]||[0,0,0],hasMore|=!!patterns[patternIndex][channelIndex],nextSampleOffset=outSampleOffset+(patterns[patternIndex][0].length-2-!notFirstBeat)*beatLength,i=2,k=outSampleOffset;i<patternChannel.length+(sequenceIndex==sequence.length-1);notFirstBeat=++i){for(note=patternChannel[i],stop=instrument!=(patternChannel[0]||0)|note|0,j=0;j<beatLength&&notFirstBeat;j++>beatLength-99&&stop?attenuation+=(attenuation<1)/99:0)sample=(1-attenuation)*sampleBuffer[sampleOffset++]/2||0,leftChannelBuffer[k]=(leftChannelBuffer[k]||0)+sample*panning-sample,rightChannelBuffer[k]=(rightChannelBuffer[k++]||0)+sample*panning+sample;note&&(attenuation=note%1,panning=patternChannel[1]||0,(note|=0)&&(sampleBuffer=sampleCache[[instrument=patternChannel[sampleOffset=0]||0,note]]=sampleCache[[instrument,note]]||(instrumentParameters=[...instruments[instrument]],instrumentParameters[2]*=2**((note-12)/12),zzfxG(...instrumentParameters))))}outSampleOffset=nextSampleOffset});return[leftChannelBuffer,rightChannelBuffer]})(...ObliqueMystique),localStorage["OS13kMusic,WIZARD WITH A SHOTGUN - Oblique Mystique"]=JSON.stringify(ObliqueMystique)},update(){Audio.readyToPlay&&(Audio.musicPlaying||(Audio.musicPlaying=!0))},play(sound){Audio.readyToPlay&&zzfx(...sound)},pause(){Audio.gain_.gain.linearRampToValueAtTime(0,Audio.ctx.currentTime+1)},unpause(){Audio.gain_.gain.linearRampToValueAtTime(1,Audio.ctx.currentTime+1)}},Hud={init(){},draw(){}};class ScreenShake{constructor(frames,hAmplitude,vAmplitude){this.frames=frames,this.hAmplitude=hAmplitude,this.vAmplitude=vAmplitude,this.hSamples=[],this.vSamples=[];var sampleCount=frames/2;for(let i=0;i<sampleCount;i++)this.hSamples.push(2*Math.random()-1),this.vSamples.push(2*Math.random()-1);this.frame=-1}update(){if(this.frame++,this.frame>=this.frames)return!1;let s=this.frame/2,s0=0|s,s1=s0+1,decay=1-this.frame/this.frames;return this.x=this.hAmplitude*decay*(this.hSamples[s0]+(s-s0)*(this.hSamples[s1]-this.hSamples[s0])),this.y=this.vAmplitude*decay*(this.vSamples[s0]+(s-s0)*(this.vSamples[s1]-this.vSamples[s0])),!0}}const Screen={init(){this.screen=[];for(let y=0;y<25;y++)this.screen.push([]);this.clear()},clear(){for(let y=0;y<25;y++)for(let x=0;x<80;x++)this.screen[y][x]=" "},write(x,y,text){Array.isArray(text)||(text=[text]);for(let j=0;j<text.length;j++)for(let i=0;i<text[j].length;i++)this.screen[y+j][x+i]=text[j][i]},drawToViewport(){let text=this.screen.map(row=>row.join("")).join("\n");Text.drawText(Viewport.ctx,Text.splitParagraph(text,Viewport.width),0,0,1,Text.terminal,Text.terminal_shadow)}};class MainMenu{constructor(){}update(){switch(Input.lastKeyPressed().toUpperCase()){case"P":Input.consume(),game.startSession();break;case"L":Input.consume(),game.playSpeed=(game.playSpeed+1)%PLAY_SPEEDS.length;break;case"I":case"E":Input.consume(),game.showInstructions()}}draw(){let highScores=["1) 6000  Bob","2) 6000  Tom","3) 4000  Wayne","",""];Screen.clear(),Screen.write(0,0,["               LL                     dd       dd","               LL                     dd       dd                      tm","               LL         aaaa     ddddd    ddddd    eeee   rrrrrrr","               LL        aa  aa   dd  dd   dd  dd   ee  ee  rr    rr","               LL        aa  aa   dd  dd   dd  dd   eeeeee  rr","               LL        aa  aa   dd  dd   dd  dd   ee      rr","               LLLLLLLL   aaa aa   ddd dd   ddd dd   eeee   rr","","                                       Version:    ?","(c) 1982, 1983 Yahoo Software          Terminal:   ?",`10970 Ashton Ave.  Suite 312           Play speed: ${game.playSpeed+1} / ${PLAY_SPEEDS.length}`,"Los Angeles, Ca  90024                 Move = ↑↓←→/WASD, Jump = Space,","                                       Stop = Other","","P = Play game                          High Scores","L = Change level of difficulty         "+highScores[0],"C = Configure Ladder                   "+highScores[1],"I = Instructions                       "+highScores[2],"E = Exit Ladder                        "+highScores[3],"                                       "+highScores[4],"","Enter one of the above:"])}}class InstructionsMenu{constructor(){}update(){""!==Input.lastKeyPressed().toUpperCase()&&(Input.consume(),game.showMainMenu())}draw(){Screen.clear(),Screen.write(0,0,["You are a Lad trapped in a maze.  Your mission is is to explore the","dark corridors never before seen by human eyes and find hidden","treasures and riches.","","You control Lad by typing the direction buttons and jumping by","typing SPACE.  But beware of the falling rocks called Der rocks.","You must find and grasp the treasures (shown as $) BEFORE the","bonus time runs out.","","A new Lad will be awarded for every 10,000 points.","Extra points are awarded for touching the gold","statues (shown as &).  You will receive the bonus time points","that are left when you have finished the level.","","Type an ESCape to pause the game.","","Remember, there is more than one way to skin a cat. (Chum)","","Good luck Lad.","","","","Type RETURN to return to main menu:"])}}const State={STOPPED:1,UP:2,LEFT:3,DOWN:4,RIGHT:5,FALLING:6,START_JUMP:7,JUMP_LEFT:8,JUMP_RIGHT:9,JUMP_UP:10,DYING:11,DEAD:12},JUMP_FRAMES={[State.JUMP_RIGHT]:[{x:1,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:0},{x:1,y:1},{x:1,y:1}],[State.JUMP_LEFT]:[{x:-1,y:-1},{x:-1,y:-1},{x:-1,y:0},{x:-1,y:0},{x:-1,y:1},{x:-1,y:1}],[State.JUMP_UP]:[{x:0,y:-1},{x:0,y:-1},{x:0,y:0},{x:0,y:1},{x:0,y:1},{x:0,y:0}]};class Entity{applyMovement(field){let repeat=!1;if(this.nextState)switch(this.state){case State.STOPPED:case State.LEFT:case State.RIGHT:[State.LEFT,State.RIGHT,State.STOPPED].includes(this.nextState)&&(this.state=this.nextState,this.nextState=void 0);break;case State.UP:case State.DOWN:[State.LEFT,State.RIGHT].includes(this.nextState)&&(this.state=this.nextState,this.nextState=void 0)}switch(this.nextState===State.START_JUMP?field.onSolid(this.x,this.y)?this.state===State.STOPPED||this.state===State.FALLING?(this.state=State.JUMP_UP,this.jumpStep=0,this.nextState=State.STOPPED):this.state===State.LEFT||this.state===State.JUMP_LEFT?(this.state=State.JUMP_LEFT,this.jumpStep=0,this.nextState=State.LEFT):this.state!==State.RIGHT&&this.state!==State.JUMP_RIGHT||(this.state=State.JUMP_RIGHT,this.jumpStep=0,this.nextState=State.RIGHT):this.state===State.JUMP_UP||this.state===State.FALLING?this.nextState=State.STOPPED:this.state===State.JUMP_RIGHT?this.nextState=State.RIGHT:this.state===State.JUMP_LEFT&&(this.nextState=State.LEFT):this.nextState===State.UP&&field.isLadder(this.x,this.y)?(this.state=State.UP,this.nextState=void 0):this.nextState===State.DOWN&&(field.isLadder(this.x,this.y)||field.isLadder(this.x,this.y+1))&&(this.state=State.DOWN,this.nextState=void 0),this.state){case State.LEFT:if(!field.onSolid(this.x,this.y)){this.nextState=State.LEFT,this.state=State.FALLING,repeat=!0;break}field.emptySpace(this.x-1,this.y)?this.x--:this.nextState=State.STOPPED;break;case State.RIGHT:if(!field.onSolid(this.x,this.y)){this.nextState=State.RIGHT,this.state=State.FALLING,repeat=!0;break}field.emptySpace(this.x+1,this.y)?this.x++:this.nextState=State.STOPPED;break;case State.UP:field.canClimbUp(this.x,this.y-1)?this.y--:this.state=State.STOPPED;break;case State.DOWN:field.canClimbDown(this.x,this.y+1)?this.y++:this.state=State.STOPPED;break;case State.JUMP_RIGHT:case State.JUMP_LEFT:case State.JUMP_UP:let step=JUMP_FRAMES[this.state][this.jumpStep];if(console.log(["jump",this.state,this.jumpStep,step]),this.x+step.x>=0&&this.x+step.x<79){let terrain=field.layout[this.y+step.y][this.x+step.x];if(["=","|","-"].includes(terrain))if(field.onSolid(this.x,this.y))this.state=this.nextState,this.nextState=void 0;else{switch(this.state){case State.JUMP_RIGHT:this.nextState=State.RIGHT;break;case State.JUMP_LEFT:this.nextState=State.LEFT;break;case State.JUMP_UP:this.nextState=State.UP}this.state=State.FALLING}else"H"===terrain?(this.x+=step.x,this.y+=step.y,this.state=State.STOPPED,this.nextState=void 0):(this.x+=step.x,this.y+=step.y,this.jumpStep++,this.jumpStep>=JUMP_FRAMES[this.state].length&&(this.state=this.nextState,this.nextState=void 0))}else field.onSolid(this.x,this.y)?(this.state=this.nextState,this.nextState=void 0):(this.state=State.FALLING,this.nextState=State.STOPPED);break;case State.FALLING:field.onSolid(this.x,this.y)?this.state=this.nextState||State.STOPPED:this.y++}if(repeat)return this.applyMovement(field)}}const DEATH_FRAMES=["p","b","d","q","p","b","d","q","-","-","_"];class Player extends Entity{constructor(x,y){super(),this.x=x,this.y=y,this.state=State.STOPPED,this.nextState=State.STOPPED,this.jumpStep=0,this.deathStep=0,console.log("player constructed",x,y)}update(){if(this.state===State.DYING&&(this.deathStep++,this.deathStep>=DEATH_FRAMES.length&&(this.state=State.DEAD)),this.state===State.DYING||this.state===State.DEAD)return;let action=Input.lastActionPressed();return action===Input.Action.LEFT?(this.nextState=State.LEFT,Input.consume()):action===Input.Action.RIGHT?(this.nextState=State.RIGHT,Input.consume()):action===Input.Action.UP?(this.nextState=State.UP,Input.consume()):action===Input.Action.DOWN?(this.nextState=State.DOWN,Input.consume()):action===Input.Action.JUMP&&(this.nextState=State.START_JUMP,Input.consume()),this.applyMovement(game.session.field)}draw(){let char="g";switch(this.state){case State.RIGHT:case State.JUMP_RIGHT:case State.UP:case State.DOWN:char="p";break;case State.LEFT:case State.JUMP_LEFT:char="q";break;case State.FALLING:char="b";break;case State.DYING:char=DEATH_FRAMES[this.deathStep];break;case State.DEAD:char="_"}Screen.write(this.x,this.y,char)}}const DEATH_FRAMES$1=["%",":"];class Rock extends Entity{constructor(dispenser){super(),this.x=dispenser.x,this.y=dispenser.y,this.state=State.FALLING,this.nextState=void 0,this.deathStep=0}update(field){if(this.state===State.DYING&&(this.deathStep++,this.deathStep>=DEATH_FRAMES$1.length&&(this.state=State.DEAD)),this.state!==State.DYING&&this.state!==State.DEAD){if(this.state===State.STOPPED&&(0!==this.x&&field.emptySpace(this.x-1,this.y)?78!==this.x&&field.emptySpace(this.x+1,this.y)?this.nextState=Math.random()>.5?State.LEFT:State.RIGHT:this.nextState=State.LEFT:this.nextState=State.RIGHT),0===this.x&&this.state===State.LEFT&&(this.state=State.RIGHT),78===this.x&&this.state===State.RIGHT&&(this.state=State.LEFT),this.state===State.FALLING||field.onSolid(this.x,this.y)||(this.nextState=State.FALLING),field.isLadder(this.x,this.y+1)&&[State.LEFT,State.RIGHT].includes(this.state)){let r=Math.floor(4*Math.random());this.nextState=[State.LEFT,State.RIGHT,State.DOWN,State.DOWN][r]}field.isEater(this.x,this.y)?this.state=State.DYING:this.applyMovement(field)}}draw(){let char="o";switch(this.state){case State.DYING:char=DEATH_FRAMES$1[this.deathStep];break;case State.DEAD:return}Screen.write(this.x,this.y,char)}}const Level={LEVELS:[{name:"Easy Street",time:35,maxRocks:5,layout:["                                       V                 $                     ","                                                         H                     ","                H                                        H                     ","       =========H==================================================            ","                H                                                              ","                H                                                              ","                H          H                             H                     ","================H==========H==================   ========H=====================","                &          H                             H          |       |  ","                                                         H         Easy Street ","                H                                        H                     ","       =========H==========H=========  =======================                 ","                H                                                              ","                H                                                              ","                H                                        H                     ","======================== ====================== =========H==============       ","                                                         H                     ","                                                         H                     ","*    p                                                   H                    *","==============================================================================="]},{name:"Long Island",time:45,maxRocks:8,layout:["                                                                          $    ","                                                                   &      H    ","    H       |V                                                     V|     H    ","====H======================= ========================= ======================  ","    H                                                                          ","    H                                                                          ","    H                    & |                         . .                  H    ","========================== ======  =================== ===================H==  ","                                                                          H    ","                                  |                                       H    ","    H                             |                 .  .                  H    ","====H=====================   ======  ================  ======================  ","    H                                                                          ","    H                      |                                                   ","    H                      |                        .   .                 H    ","=========================  ========    ==============   ==================H==  ","                                                                          H    ","==============                      |                                     H    "," Long Island |   p         *        |                 *                   H    ","==============================================================================="]},{name:"Ghost Town",time:35,maxRocks:5,layout:["                            V               V           V               $      ","                                                                       $$$     ","     p    H                                                    H      $$$$$   H","==========H===                                                =H==============H","          H                                                    H              H","          H                              &                     H              H","     ==============   ====     =    ======    =   ====    =====H=====         H","    G              ^^^    ^^^^^ ^^^^      ^^^^ ^^^    ^^^                     $","    h                                                                 |        ","    o     |                     H                             &       |        ","    s     ======================H============================== ===========    ","    t        &                  H                                              ","                                H                                              ","              |                 H                 H                   H        ","    T         ==================H=================H===================H======= ","    o                                             H                   H        ","    w                                                                 H        ","    n                           ^                                     H        ","*                              ^^^                                    H       *","==============================================================================="]},{name:"Tunnel Vision",time:36,rocks:5,layout:["                                            V                       V          ","                                                                               ","     H             H                         |                H                ","=====H=====--======H==========================     ===----====H===========     ","     H             H                |&&                       H                ","     H             H                ==================        H                ","     H             H                       tunnel  H          H                ","     H           =======---===----=================H=         H           H    ","     H         |                           vision  H          H           H    ","     H         =========---&      -----============H          H           H    ","     H           H                                 H |        H           H    ","     H           H=========----===----================        H  ==============","                 H                                        &   H                ","                 H                                        |   H                ","====---====      H                                        |   H                ","|         |    ================---===---===================   H                ","|   ===   |                                                   H        H    p  ","|    $    |                                                   H     ===H=======","|*  $$$  *|   *                *       *                     *H       *H       ","==============================================================================="]},{name:"Point of No Return",time:35,maxRocks:7,layout:["         $                                                                     ","         H                                                   V                 ","         H                                                                     ","         HHHHHHHHHHHHH     .HHHHHHHHHHHHHH                          H    p     ","         &                   V           H                        ==H==========","                                         H                          H          ","   H                                     H        .                 H          ","===H==============-----------============H====                      H          ","   H                                                      H         H          ","   H                                                 =====H==============      ","   H                                     H                H                    ","   H              &..^^^.....^..^ . ^^   H==---------     H                    ","   H         ============================H    &           H             H      ","   H         ===      ===      ===       H    ---------=================H======","   H                                     H                              H      ","   H                          &          H          &                   H      ","   ==========-------------------------=======----------===================     ","                                                                               ","^^^*         ^^^^^^^^^^^^^^^^^^^^^^^^^*     *^^^^^^^^^^*Point of No Return*^^^^","==============================================================================="]},{name:"Bug City",time:37,maxRocks:6,layout:["        Bug City             HHHHHHHH                          V               ","                           HHH      HHH                                        ","   H                                          >mmmmmmmm                        ","   H===============                   ====================          H          ","   H              |=====       \\  /         V                  =====H==========","   H                            \\/                                  H          ","   H                                        | $                     H          ","   H           H                            | H                     H          ","   H       ====H=======          p          |&H    H                H          ","   H           H             ======================H           ======          ","   H           H      &|                           H                    H      ","   H           H      &|                    H      H     }{        =====H====  ","===H===&       H       =====================H      H                    H      ","               H                            H      H                    H      ","               H                            H      &                    H      ","         ======H===   =======    H    <>    &                           H      ","                                 H==========       =====     =     ============","     }i{                         H                                             ","*                                H                                            *","==============================================================================="]},{name:"GangLand",time:32,maxRocks:6,layout:["                    =Gang Land=                             V                  ","                   ==      _  ==                                      .        ","      p    H        |  [] |_| |                  &                    .  H     ","===========H        |     |_| |       H         ===   ===================H     ","      V    H        =============     H======                            H     ","           H                          H                     &            H     ","           H                          H                |    |            H     ","    H      H        ^^^&&^^^ & ^  ^^^ H           H    |    =============H     ","    H======H   =======================H===========H=====          &      H     ","    H                                 H           H    |         &&&     H     ","    H                                 H           H    |        &&&&&    H     ","    H                                 H           H    |    =============H     ","              =====------=================        H    |       $     $         ","                                         |        H    |      $$$   $$$        ","====------===                            |        H    |     $$$$$ $$$$$       ","            |       =                    | =============    ============       ","            |       $                     ^          &                         ","            |^^^^^^^^^^^^^^      $ ^              ======                       ","*                   .      &   ^ H*^                    ^  ^       ^^^^^^^^^^^^","==============================================================================="]}],load(levelNumber){console.log(Level.LEVELS);let level=Level.LEVELS[levelNumber%Level.LEVELS.length];if(!level)throw new Error("No such level number: "+levelNumber);let player,layout=level.layout.map(row=>row.split("")),dispensers=[];layout=layout.slice(0,20);for(let y=0;y<20;y++){layout[y]||(layout[y]=[]),layout[y]=layout[y].slice(0,79);for(let x=0;x<79;x++)layout[y][x]||(layout[y][x]=" "),"V"===layout[y][x]&&dispensers.push({x:x,y:y}),"p"===layout[y][x]&&(layout[y][x]=" ",player={x:x,y:y})}return{name:level.name,time:level.time,maxRocks:level.maRrocks,layout:layout,dispensers:dispensers,player:player}}};class Field{constructor(levelNumber){let level=Level.load(levelNumber);this.layout=level.layout,this.dispensers=level.dispensers,this.time=level.time,this.maxRocks=level.rocks,this.rocks=[],this.player=new Player(level.player.x,level.player.y)}update(){let oldX=this.player.x,oldY=this.player.y;this.player.update(),oldX!==this.player.x&&oldY===this.player.y&&this.isDisappearingFloor(oldX,oldY+1)&&(this.layout[oldY+1][oldX]=" "),this.checkIfPlayerShouldDie(game.session);for(let rock of this.rocks)rock.update(this);if(this.checkIfPlayerShouldDie(game.session),this.isStatue(this.player.x,this.player.y)&&(this.layout[this.player.y][this.player.x]=" ",game.session.updateScore(1)),this.isTreasure(this.player.x,this.player.y)&&game.session.startNextLevel(),this.isTrampoline(this.player.x,this.player.y))switch(Math.floor(5*Math.random())){case 0:this.player.state=State.LEFT,this.player.nextState=void 0;break;case 1:this.player.state=State.RIGHT,this.player.nextState=void 0;break;case 2:this.player.state=State.JUMP_UP,this.player.nextState=void 0,this.player.jumpStep=0;break;case 3:this.player.state=State.JUMP_LEFT,this.player.nextState=State.LEFT,this.player.jumpStep=0;break;case 4:this.player.state=State.JUMP_RIGHT,this.player.nextState=State.RIGHT,this.player.jumpStep=0}if(this.rocks.length<3&&Math.random()>.9){let dispenser=this.dispensers[Math.floor(Math.random()*this.dispensers.length)];this.rocks.push(new Rock(dispenser))}this.rocks=this.rocks.filter(rock=>rock.state!==State.DEAD),this.player.state===State.DEAD&&game.session.restartLevel()}draw(){Screen.write(0,0,this.layout.map(row=>row.join(""))),this.player.draw(),this.rocks.forEach(rock=>rock.draw())}onSolid(x,y){return["=","-","H","|"].includes(this.layout[y+1][x])||"H"===this.layout[y][x]}emptySpace(x,y){return!(x<0||x>=79)&&!["|","="].includes(this.layout[y][x])}isLadder(x,y){return"H"===this.layout[y][x]}isStatue(x,y){return"&"===this.layout[y][x]}isTreasure(x,y){return"$"===this.layout[y][x]}isTrampoline(x,y){return"."===this.layout[y][x]}isEater(x,y){return"*"===this.layout[y][x]}isFire(x,y){return"^"===this.layout[y][x]}isDisappearingFloor(x,y){return"-"===this.layout[y][x]}canClimbUp(x,y){return!(y<0)&&["H","&","$"].includes(this.layout[y][x])}canClimbDown(x,y){return["H","&","$"," ","^","."].includes(this.layout[y][x])}checkIfPlayerShouldDie(){if(this.player.state!==State.DYING&&this.player.state!==State.DEAD){this.isFire(this.player.x,this.player.y)&&(this.player.state=State.DYING);for(let i=0;i<this.rocks.length;i++)if(this.player.x===this.rocks[i].x){if(this.player.y===this.rocks[i].y){this.player.state=State.DYING,this.rocks.splice(i,1);break}(this.player.y===this.rocks[i].y-1&&this.emptySpace(this.player.x,this.player.y+1)||this.player.y===this.rocks[i].y-2&&this.emptySpace(this.player.x,this.player.y+1)&&this.emptySpace(this.player.x,this.player.y+2))&&game.session.updateScore(0)}}}}class Session{constructor(){this.score=0,this.levelNumber=0,this.levelCycle=1,this.lives=5,this.nextLife=100}update(){this.field||(this.field=new Field(this.levelNumber)),this.field.update();let recentKeystrokes=Input.buffer.map(event=>event.key).join("").toUpperCase();recentKeystrokes.match(/IDCLEV(\d\d)/)?(Input.consume(),this.field=void 0,this.levelNumber=parseInt(RegExp.$1,10)):recentKeystrokes.includes("IDDQD")&&(Input.consume(),console.log("god mode"))}draw(){Screen.clear(),this.field&&this.field.draw();let stat=[String(this.lives).padStart(2," "),String(this.levelNumber+1).padStart(2," "),String(this.score).padStart(4,"0"),this.field?String(this.field.time).padStart(4," "):""];Screen.write(0,21,`Lads   ${stat[0]}   Level   ${stat[1]}    Score   ${stat[2]}    Bonus time   ${stat[3]}`)}restartLevel(){this.field=void 0}startNextLevel(){this.field=void 0,this.levelNumber++,this.levelNumber%LEVEL_ORDER.length==0&&this.levelCycle++}updateScore(scoreType){switch(scoreType){case 0:this.score+=2;break;case 1:this.score+=this.field.time;break;case 2:this.score+=1}}}const game=new class{init(){Sprite.loadSpritesheet(async()=>{await Viewport.init(),await Screen.init(),await Sprite.init(),Text.init(),Hud.init(),Input.init(),Audio.init(),this.entities=[],this.dialogPending={},this.dialogSeen={},this.roomsCleared={},this.shadowOffset=0,this.screenshakes=[],this.camera={pos:{x:0,y:0}},this.cameraFocus={pos:{x:0,y:0}},window.addEventListener("blur",()=>this.pause()),window.addEventListener("focus",()=>this.unpause()),this.start()})}start(){this.frame=0,this.frameTimes=[],this.menu=new MainMenu,this.playSpeed=0,this.update(),window.requestAnimationFrame(delta=>this.onFrame(delta))}onFrame(){let desiredFps=this.session?PLAY_SPEEDS[this.playSpeed]:60,now=(new Date).getTime();now-(this.lastFrame||0)>=1e3/desiredFps&&(this.update(),this.lastFrame=now),Viewport.resize(),this.draw(),window.requestAnimationFrame(()=>this.onFrame())}update(){Input.update(),this.paused||(Audio.update(),this.menu&&this.menu.update(),this.session&&this.session.update(),this.screenshakes=this.screenshakes.filter(screenshake=>screenshake.update()),game.frame%6==0&&(this.shadowOffset=10*Math.random()|0),30===game.frame&&game.screenshakes.push(new ScreenShake(20,20,20)))}draw(){Viewport.ctx.setTransform(Viewport.scale,0,0,Viewport.scale,0,0),Viewport.ctx.fillStyle="black",Viewport.ctx.fillRect(0,0,Viewport.width,Viewport.height),Viewport.ctx.translate((Viewport.width-640)/2|0,(Viewport.height-400)/2|0),this.session&&this.session.draw(),this.menu&&this.menu.draw(),Screen.drawToViewport()}pause(){this.paused||(this.paused=!0,Audio.pause())}unpause(){this.paused&&(this.paused=!1,Audio.unpause())}startSession(){this.menu=void 0,this.session=new Session}showMainMenu(){this.menu=new MainMenu,this.session=void 0}showInstructions(){this.menu=new InstructionsMenu,this.session=void 0}};game.init()}();
//# sourceMappingURL=app.js.map
